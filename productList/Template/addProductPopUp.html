<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product Details Popup</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<style>
    .productSubmit{
                border-radius: 20px;
                background-color: #f5ab1e;
                color: white;
                }
                
    .productSubmit:hover { 
        transition: background-color 0.3s ease;
        background-color: transparent;
        border-color: #f5ab1e;
        color: #f5ab1e;
        }
</style>

<body>
    <div class="container mt-4 d=flex flex-column align-items-center">
        <form action="" class="w-50">
            <h2 class="fw-bold mb-4 text-start">Add Product</h2>
            <div class="mb-3">
                <label for="name" class="form-label fw-bold">Name:</label>
                <input type="text" class="form-control" id="name" name="name" placeholder="Tomato">
            </div>
            <div class="mb-3">
                <label for="price" class="form-label fw-bold">Price:</label>
                <input type="text" class="form-control" id="price" name="price" placeholder="5.50">
            </div>
            <div class="mb-3">
                <label for="description" class="form-label fw-bold">Description:</label>
                <input type="text" class="form-control" id="description" name="description" placeholder="Lorem">
            </div>
            <div class="mb-3">
                <label for="stock" class="form-label fw-bold">Stock:</label>
                <input type="text" class="form-control" id="stock" name="stock" placeholder="200">
            </div>
            <div class="mb-3">
                <label for="category" class="form-label fw-bold">Category:</label>
                <input type="text" class="form-control" id="category" name="category" placeholder="bagel">
            </div>
            <div class="mb-3">
                <label for="image" class="form-label fw-bold">Image:</label>
                <input type="text" class="form-control" id="image" name="image" placeholder="images.google.com">
            </div>
            <div class="mb-3">
                <label for="size" class="form-label fw-bold">Size (g):</label>
                <input type="text" class="form-control" id="size" name="size" placeholder="50">
            </div>
            <div class="mb-3">
                <label for="discount" class="form-label fw-bold">Discount (%):</label>
                <input type="text" class="form-control" id="discountPercentage" name="discountPercentage" placeholder="20%">
            </div>
            <div class="d-grid">
                <button type="submit" class="productSubmit btn btn-light fw-bold mt-2 px-4 py-2">Submit</button>
            </div>
        </form>
    </div>
    <script src="https://code.jquery.com/jquery-4.0.0.min.js" integrity="sha256-OaVG6prZf4v69dPg6PhVattBXkcOWQB62pdZ3ORyrao=" crossorigin="anonymous"></script>
    <script type = "module">
        import{Product, loadProducts, saveProducts} from "../../component/Product.js"

        $(document).ready(function(){
            const allowedCategories = [
                "bagel", "candy", "beans", "bestseller", "bread", "biscuite", "breakfast", "cake", "cookie", "cupcake", "Dairy&Cheese", "Dinner"
            ];
            $("form").on("submit", function(e){
                e.preventDefault();
                let isValid = true;

                $(".form-control").removeClass("is-invalid");
                $(".invalid-feedback").remove();

                let name = $("#name").val().trim();
                let price = parseFloat($("#price").val());
                let description = $("#description").val().trim();
                let stock = parseInt($("#stock").val());
                let category = $("#category").val().trim();
                let image = $("#image").val().trim();
                let size = parseInt($("#size")).val();
                let discountPercentage = parseInt($("#discountPercentage")).val();

                if (name.length<3){
                    showError("#name", "Name must be at least 3 characters");
                    isValid = false;
                }
                if (isNaN(price) || price<=0){
                    showError("#price", "Price must be a number greater than 0");
                    isValid = false;
                }
                if (description.length < 100 || description.length > 200){
                    showError("#description", "Description must be at least 100 characters and less than 200");
                    isValid = false;
                }
                if (isNaN(stock) || stock<=0){
                    showError("#stock", "Stock must be a number greater than 0");
                    isValid = false;
                }
                if (!allowedCategories.includes(category)){
                    showError("#category", "Invalid Category, allowed categories: bagel, candy, beans, bestseller, bread, biscuite, breakfast, cake, cookie, cupcake, Dairy&Cheese, Dinner");
                    isValid = false;
                }
                if (!isValidURL(image)) {
                    showError("#image", "Enter a valid image URL.");
                    isValid = false;
                }
                if(isNan(size) || size<=0){
                    showError("#size","Size value must be more than 0");
                    isValid = false;
                }
                if(isNaN(discountPercentage) || discountPercentage<0 || discountPercentage>100){
                    showError("#discountPercentage","Discount Percentage must be a number between 0 and 100");
                    isValid = false;
                }
                if (!isValid) return;

                try{
                    let products = loadProducts() || [];

                    const newProduct = new Product(
                        Date.now(),
                        name,
                        price,
                        description,
                        stock,
                        category,
                        image,
                        size,
                        discountPercentage
                    );
                    products.push(newProduct);

                    saveProducts(products);
                    alert("Product added Successfully!");
                    window.location.href = "product_list.html"
                }catch(error){
                    alert(error.message)
                }


            });

            function showError(selector, message){
                $(selector).addClass("is-invalid");
                $(selector).after(`<div class= "invalid-feedback">${message}<div>`);
            }
            function isValidURL(url){
                try{
                    new URL(url);
                    return true;
                } catch(err){
                    return false;
                }
            }
        });
    </script>
</body>